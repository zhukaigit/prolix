# mysql数据库知识

## 参考资源

友情提示：按住command再点击链接跳转

1. 数据库系列：https://www.cnblogs.com/Jtianlin/p/8868697.html
2. 数据库架构：https://www.cnblogs.com/Jtianlin/p/8904129.html
3. 数据库容量：https://www.cnblogs.com/Jtianlin/p/8904187.html

## 数据库三范式

1. **第一范式**：数据库的每一列都是不可分割的，即具有原子性。
   注意：这个也得根据实际业务具体对待。比如：1）我们业务系统需求是需要统计某个省下某个市的信息，那么如果我们数据库记录地址信息如果只有【地址】这一列，那么就无法完成，需要将【地址】这一列分解成【省、市、区、详细地址】。2）我们系统一般都有【姓名】这一列，那么我们有必要将这一列拆分成【姓、名】两列吗，如果业务有需求时统计每个姓的所有信息，那么就需要拆分，否则就没必要了。

2. **第二范式**：确保数据库表中每一列都与主键相关，而不能只与主键的某一部分相关（主要针对联合主键而言）；简而言之，就是一个表只保存一种数据，不要将多种数据保存在一个表中。
   如下订单信息表：每一个订单对应多个商品，一个客户。下表就想商品信息、客户信息、订单信息都保存在一个表中了
   **订单信息表01：**

   | 订单编号 | 商品名称 | 商品单价 | 商品数量 | 客户名称 | 客户电话    |
   | -------- | -------- | -------- | -------- | -------- | ----------- |
   | 001      | 面包     | 2元      | 10       | 张三     | 13011112222 |
   | 001      | 方便面   | 3元      | 5        | 张三     | 13011112222 |

   该表的联合主键可以为：订单编号+商品名称。但是可以发现，商品单价这一列只与联合主键中的商品名称有关，不符合第二范式，那么应该将商品信息这一列抽离出来，参考如下：
   **订单信息表02:**

   | 订单信息 | 商品编号 | 商品数量 | 客户名称 | 客户电话    |
   | -------- | -------- | -------- | -------- | ----------- |
   | 001      | 1        | 10       | 张三     | 13011112222 |
   | 001      | 2        | 5        | 张三     | 13011112222 |

   **商品信息表：**（主键）

   | 商品编号 | 商品名称 | 商品单价 |
   | -------- | -------- | -------- |
   | 1        | 面包     | 2元      |
   | 2        | 方便面   | 3元      |

3. **第三范式**：确保数据库的每一列都与主键直接关联，而不是间接关联。
   如上面的【订单信息表02】，订单信息确定客户名称，客户名称确定客户电话，可以说明客户电话与主键信息是间接关联。可以修改成如下设计：
   **订单信息表03:**

   | 订单信息 | 商品编号 | 商品数量 | 客户编号 |
   | -------- | -------- | -------- | -------- |
   | 001      | 1        | 10       | 1        |
   | 001      | 2        | 5        | 1        |

   **客户信息表：**

   | 客户编号 | 客户电话    | 客户姓名 |
   | -------- | ----------- | -------- |
   | 1        | 13011112222 | 张三     |

4. 总结：**第一范式(确保每列保持原子性)**；**第二范式(确保表中的每列都和主键相关)**；**第三范式(确保每列都和主键列直接相关,而不是间接相关)**。数据库按照3范式设计，可以保证数据冗余最小，但这对于业务系统来说并不一定是最好的设计，我们应该根据需求和性能，可以适当的冗余一些字段，以提高效率。
   比如：假如我们经常统计订单的金额，那么就可在订单信息表中新增一列商品总价，其值 = 商品单价 * 商品数量。



## 数据库设计

### 建表步骤

1. 分析业务需求，找出所有的实体表（即基础表）
2. 通过E-R图，画出所有表之间的关联关系
3. 建表

### 建表规则

1. **表设计规范**
   1. 库名、表明、字段名必须使用小写字母，“_“分割
   2. 库名、表明、字段名长度不超过12个字符
   3. 库名、表明、字段见名知意，使用名词，且不使用复数形式。
   4. 储存精度使用decimal，而不使用float和double。
      decimal(m,n)：m表示整数位+小数位的总长度，n表示小数点的长度，即使插入数据为0.12345，也会将其截断为0.12。【小数位长度 = n， 整数位长度 = m - n】
   5. 使用unsigned储存非负整数
   6. 定义int类型时，不建议添加长度，如int(4)
      int(3)与int(11)有什么区别：1、储存时所占的长度完全一致。2、只有字段在设置了zerofill时，若插入的数据长度没有达到指定长度，会在前面用0填充到指定长度
   7. 建议字段定义为NOT NULL。
   8. 将过大字段拆分到其他表中。
2. **索引**
   1. **索引规范**
      若表中的数据量比较小（300行以下），没有必要设置索引。因为由于数据较少，可能查询全部数据花费的时间比遍历索引的时间还要短，索引就可能不会产生优化效果。
      1. 联合索引字段数量尽量不要超过5个
      2. 单表的索引数量尽量不要超过5个
      3. 索引字段的长度不能过大，若字段较大，则创建索引时应加以限制，前提是能够有较好的辨识度
      4. 适合创建索引的字段
         1. 经常出现在where子句中
         2. 关联的外键
         3. 经常出现在order by , group by, distinct中的字段
      5. 不适合创建索引的字段
         1. 辨识度不高的字段，如：sex, is_delete等
         2. 字段类型为TEXT、BLOG、IMAGE等类型的字段不宜建立索引
         3. 索引字段尽量设置成NOT NULL
         4. 很少作为查询条件的字段
   2. **索引优缺点**
      1. 优点：最大的优点即提高了查询效率；其次唯一索引，可以保证数据的唯一性；
      2. 缺点：索引需要占用一定的磁盘空间，甚至可能超过原始数据的大小。降低update、insert、delete的执行效率